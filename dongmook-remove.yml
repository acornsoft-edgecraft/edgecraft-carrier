---
- hosts: masters[0]
  remote_user: "{{ remote_user }}"
  vars:
    removed:  
      koreboard: false
      kong: false
      gitlab: false
      argocd: false
      nexus: false
      jaeger: false
      grafana: false
      kiali: false
      istio: false
      prometheus: false
      kubesphere: false

    chart_version:
      kiali-operator: "1.30.0"
      consul: "0.37.0"

  tasks:

  # - name: grafana helm remove in cluster
  #   when: "{{ removed.grafana }}"
  #   kubernetes.core.helm:
  #     name: "{{ grafana }}"
  #     kubeconfig: "{{ kubeconfig }}"
  #     release_namespace: "{{ monitoring_namespace }}"
  #     state: absent
  #     wait: true

  # - name: kubesphere k8s remove in cluster
  #   when: "{{ removed.kubesphere }}"
  #   kubernetes.core.k8s:
  #     name: "{{ kubesphere }}"
  #     kubeconfig: "{{ kubeconfig }}"
  #     namespace: "{{ kubesphere_namespace }}"
  #     kind: kubesphere
  #     api_version: kubesphere.io/v1alpha1
  #     state: absent
  #     wait: true

  # - name: kubesphere helm remove in cluster
  #   when: "{{ removed.kubesphere }}"
  #   shell:
  #     "{{ ansible_env.HOME }}/carrier/kubesphere-delete.sh"

  # - name: istio k8s remove in cluster
  #   when: "{{ removed.istio }}"
  #   command: >-
  #     istioctl x uninstall 
  #     --kubeconfig='{{kubeconfig}}' 
  #     -f {{ ansible_env.HOME }}/carrier/{{ istio }}.yaml 
  #     --purge 
  #     --skip-confirmation